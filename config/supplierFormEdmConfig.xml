<ofbiz-edm xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://dev.odatalab.com/dtds/edmconfig.xsd" ImportGlobal="false">

    <!--======================================SupplierParty（主对象）========================================-->
    <EntityType Name="SupplierDDForm" EntityCondition="partyId=${company.partyId}"
                OfbizEntity="PartyGroupAndContact" EntitySetName="SupplierDDForms"
                AttrDateEntityName="PartyGroupAttributeDate" AttrEntityName="PartyGroupAttribute"
                AutoProperties="true" DraftEntityName="SupplierPartyFormDraft" AutoDraft="true"
                Handler="component://officeauto/groovyScripts/partyManage/ddForm/generateEntityListFields.groovy">
        <SelectionFields PropertyPath="partyName"/>
        <HeaderInfo>
            <Title Path="ddStatus"/>
            <Description Path="partyName"/>
        </HeaderInfo>
        <RelAlias Name="BusinessLocation" Relations="PartyGeoPoint(partyGeoPointTypeId=BUSINESS_LOCATION)/GeoPoint"/>
        <RelAlias Name="PartyIdentification" Relations="PartyIdentification(partyIdentificationTypeId=REGISTRATION_NUMBER)"/>
        <Property Name="partyName" Label="${NONE}"/>
        <Property Name="dateIncorporation" IsDateAttribute="true" Type="Timestamp" Label="${NONE}"/>
        <Property Name="businessLocation" Type="String" RelAlias="BusinessLocation" Field="information" Label="${BusinessLocation}"/>
        <Property Name="registrationNumber" Type="String" RelAlias="PartyIdentification" Field="idValue" Label="${NONE}"/>
        <Property Name="workScope" Type="String" RelAlias="WorkScopeAnswer" Field="textResponse" Label="${WorkScopeAnswer}"/>
        <Property Name="ddStatus" Type="String" Label="${ddFormDealStatus}"/>

        <LineItem>
            <DataField Values="partyName" Importance="High"/>
        </LineItem>
        <!-- 1.供应商全称 -->
        <FieldGroup Label="FullName" Qualifier="FullName">
            <DataField Values="partyName" Importance="High"/>
        </FieldGroup>
        <!-- 2.注册地 -->
        <FieldGroup Label="RegisteredAddress" Qualifier="RegisteredAddress">
            <DataField Values="RegisterPostalAddress/countryGeoId,RegisterPostalAddress/stateProvinceGeoId,RegisterPostalAddress/cityGeoId,RegisterPostalAddress/address1" Importance="High"/>
        </FieldGroup>
        <!-- 3a-3b.成立日期, -->
        <FieldGroup Label="DateIncorporation" Qualifier="DateIncorporation">
            <DataField Values="dateIncorporation" Importance="High"/>
        </FieldGroup>
        <!-- 4.商登记号 -->
        <FieldGroup Label="RegistrationNumber" Qualifier="RegistrationNumber">
            <DataField Values="registrationNumber" Importance="High"/>
        </FieldGroup>
        <!-- 8.PartyRole -->
        <FieldGroup Label="BusinessRelationship" Qualifier="BusinessRelationship">
            <DataField Values="BusinessRelationship/roleTypeId" Importance="High"/>
        </FieldGroup>
        <!-- 9.工作范围 -->
        <FieldGroup Label="WorkScope" Qualifier="WorkScope">
            <DataField Values="workScope" Importance="High"/>
        </FieldGroup>
        <!-- 10.营业地点 -->
        <FieldGroup Label="BusinessLocation" Qualifier="BusinessLocation">
            <DataField Values="businessLocation" Importance="High"/>
        </FieldGroup>
        <!-- 11.更名记录 PartyNameHistory/LineItem-->
        <!-- 最终受益人 -->
        <!-- 董事/高级职员姓名 -->
        <NavigationProperty Name="PartyNameHistory"/>
        <NavigationProperty Name="BusinessRelationship" Relations="PartyRoleType(parentTypeId=BUSINESS_RELATIONSHIP)" IsCollection="true" Type="BusinessRelationship"/>
        <NavigationProperty Name="BeneficialPerson" Type="RelationshipAndToParty" IsCollection="true"
                            Relations="FromRelationshipAndToParty(roleTypeIdTo=BENEFICIAL_PERSON and roleTypeIdFrom=SUPPLIER)"/>
        <NavigationProperty Name="SeniorStaff" Type="RelationshipAndToParty" IsCollection="true"
                            Relations="FromRelationshipAndToParty(roleTypeIdTo=SENIOR_STAFF and roleTypeIdFrom=SUPPLIER)"/>
        <NavigationProperty Name="ContactPerson" Type="RelationshipAndToParty" IsCollection="true"
                            Relations="FromRelationshipAndToParty(roleTypeIdTo=CONTACT and roleTypeIdFrom=SUPPLIER)"/>
        <!-- 注册地址 -->
        <NavigationProperty Name="RegisterPostalAddress" Type="RegisterPostalAddress"
                            Relations="PartyContactMechPurpose(contactMechPurposeTypeId=REGISTERED_LOCATION)/PostalAddress" IsCollection="false"/>
        <NavigationProperty Name="RegisteredCountry" Type="PartyGeo" Relations="PartyGeo(partyGeoTypeId=REGISTERED_COUNTRY)" IsCollection="false"/>
        <!-- DDForm问题 -->
        <NavigationProperty Name="SurveyQuestionAnswer" Type="DDFormSurveyQuestionAnswer"
                            Relations="SurveyQuestionAnswer(surveyQuestionId in (9000,9001,9002,9003,9005,9006))" IsCollection="true"/>

        <!--Submit to procurement-->
        <Action Name="SubmitDDForm" IsBound="true" EntitySetPath="supplierDDForm"
                OfbizService="com.banfftech.events.DDFormEvents.submitDDForm">
            <Parameter Name="supplierDDForm" Type="SupplierDDForm" Nullable="false" IsCollection="false"/>
            <Parameter Name="noteInfo" Type="String" Label="${noteInfo}"/>
        </Action>
    </EntityType>


    <EntityType Name="RegisterPostalAddress" OfbizEntity="PostalAddress" AutoProperties="true"
                EntitySetName="RegisterPostalAddresses" DraftEntityName="PostalAddressesDDFormDraft">
        <LineItem Qualifier="PostalAddressLineItem">
            <DataField Values="countryGeoId,stateProvinceGeoId,cityGeoId,address1,address2,contactNumber,email" Importance="High"/>
        </LineItem>
        <Property Name="countryGeoId">
            <Text Path="CountryGeo/geoName" TextArrangement="TextOnly"/>
            <ValueList CollectionPath="Countries" WithFixedValues="true">
                <ParameterOut ValueListProperty="geoId" LocalDataProperty="countryGeoId"/>
            </ValueList>
        </Property>
        <Property Name="stateProvinceGeoId">
            <Text Path="StateProvinceGeo/geoName" TextArrangement="TextOnly"/>
            <ValueList CollectionPath="Provinces" WithFixedValues="true">
                <ParameterIn LocalDataProperty="countryGeoId" ValueListProperty="geoIdFrom"/>
                <ParameterOut LocalDataProperty="stateProvinceGeoId" ValueListProperty="geoId"/>
            </ValueList>
        </Property>
        <Property Name="cityGeoId">
            <Text Path="CityGeo/geoName" TextArrangement="TextOnly"/>
            <ValueList CollectionPath="Cities" WithFixedValues="true">
                <ParameterIn LocalDataProperty="stateProvinceGeoId" ValueListProperty="geoIdFrom"/>
                <ParameterOut LocalDataProperty="cityGeoId" ValueListProperty="geoId"/>
            </ValueList>
        </Property>
        <NavigationProperty Name="CountryGeo"/>
        <NavigationProperty Name="StateProvinceGeo"/>
        <NavigationProperty Name="CityGeo"/>
    </EntityType>


    <EntityType Name="DDFormSurveyQuestionAnswer" OfbizEntity="SurveyQuestionAnswer" AutoProperties="true"
                EntitySetName="DDFormSurveyQuestionAnswers" DraftEntityName="DDFormSurveyQuestionAnswerDraft"
                Handler="component://officeauto/groovyScripts/partyManage/ddForm/ddFormAnswer.groovy">
        <Property Name="enumResponse" Label="${NONE}">
            <Text Path="BooleanEnum/description" TextArrangement="TextOnly"/>
            <ValueList CollectionPath="BooleanEnums" WithFixedValues="true"/>
        </Property>
        <Property Name="responseCritical" Type="numeric"/>
        <LineItem Qualifier="AnswerLineItem">
            <DataField Values="DDFormSurveyQuestion/question,enumResponse,textResponse" Importance="High"/>
        </LineItem>
        <LineItem Qualifier="ComplianceAnswerLineItem">
            <DataField Values="DDFormSurveyQuestion/question" Importance="High"/>
            <DataField Values="enumResponse" Criticality="responseCritical" Importance="High"/>
            <DataField Values="textResponse" Importance="High"/>
        </LineItem>
        <NavigationProperty Name="DDFormSurveyQuestion" Type="DDFormSurveyQuestion" Relations="SurveyQuestion" IsCollection="false"/>
        <NavigationProperty Name="BooleanEnum" Type="BooleanEnum" Relations="RepsEnumeration" IsCollection="false"/>
    </EntityType>

    <EntityType Name="DDFormSurveyQuestion" OfbizEntity="SurveyQuestion" AutoProperties="true"
                EntitySetName="DDFormSurveyQuestions">
        <Property Name="question" Computed="true"/>
    </EntityType>

    <!-- Bool Enum -->
    <EntityType Name="BooleanEnum" OfbizEntity="Enumeration" EntitySetName="BooleanEnums" EntityCondition="enumTypeId=BOOLEAN_ENUM_TYPE" AutoProperties="true">
        <Property Name="enumId">
            <Text Path="description" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>

    <EntityType Name="ContactMechPurposeType" EntityCondition="parentTypeId=LOCATION"  EntitySetName="ContactMechPurposeTypes" AutoProperties="true">
        <Property Name="contactMechPurposeTypeId">
            <Text Path="description" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>

    <EntityType Name="PartyGeo" AutoProperties="true" EntitySetName="PartyGeos" DraftEntityName="PartyGeoDDFormDraft">
        <Property Name="geoId" Label="Country of Incorporation/Country of Birth">
            <Text Path="Geo/geoName" TextArrangement="TextOnly"/>
            <ValueList CollectionPath="Countries" WithFixedValues="true">
                <ParameterInOut LocalDataProperty="geoId" ValueListProperty="geoId"/>
            </ValueList>
        </Property>
        <NavigationProperty Name="Geo"/>
    </EntityType>

    <EntityType Name="Geo" AutoProperties="true" EntitySetName="Geos">
        <Property Name="geoId">
            <Text Path="geoName" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>
    <EntityType Name="RoleType" AutoProperties="true" EntitySetName="RoleTypes" EntityCondition="parentTypeId=BUSINESS_RELATIONSHIP">
        <Property Name="roleTypeId">
            <Text Path="description" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>
    <EntityType Name="BusinessRelationship" OfbizEntity="PartyRoleType" AutoProperties="true"
                DraftEntityName="BusinessRelationshipDraft" EntitySetName="BusinessRelationships">
        <Property Name="roleTypeId" Label="${BusinessRelationshipRoles}">
            <Text Path="description" TextArrangement="TextOnly"/>
            <ValueList CollectionPath="RoleTypes" WithFixedValues="true" Label="${RoleTypes}"/>
        </Property>
            <NavigationProperty Name="RoleType"/>
    </EntityType>

    <EntityType Name="PartyNameHistory" AutoProperties="true" DraftEntityName="PartyNameHistoryDraft" EntitySetName="PartyNameHistories">
        <Property Name="partyNameHistoryId" Computed="true"/>
        <LineItem Qualifier="HistoryList">
            <DataField Values="groupName,changeDate" Importance="High"/>
        </LineItem>
    </EntityType>

    <EntityType Name="RelationshipAndToParty" AutoProperties="true" DraftEntityName="RelationshipAndToPartyDraft"
                EntitySetName="RelationshipAndToParties" AttrEntityName="PartyRelationshipAttribute">
        <Property Name="partyRelationshipId" Computed="true"/>
        <Property Name="nationality" Label="${nationality}" Type="String" IsAttribute="true"/>
        <Property Name="copyIdentificationAttached" Type="Boolean" IsAttribute="true" Label="${copyIdentificationAttached}"/>
        <Property Name="positionTitle" Label="${position}"/>
        <Property Name="amount" Label="${partyRelationshipAmount}"/>
        <Property Name="firstName" Label="${firstName}"/>
        <Property Name="lastName" Label="${lastName}"/>
        <Property Name="primaryPhone" Label="${supplierActionPrimaryPhone}"/>
        <Property Name="primaryEmail" Label="${supplierActionPrimaryEmail}"/>
        <LineItem Qualifier="BeneficialPerson">
            <DataField Values="firstName,lastName,nationality,amount,copyIdentificationAttached" Importance="High"/>
        </LineItem>
        <LineItem Qualifier="SeniorStaff">
            <DataField Values="firstName,lastName,nationality,positionTitle,copyIdentificationAttached" Importance="High"/>
        </LineItem>
        <LineItem Qualifier="ContactPersonList">
            <DataField Values="firstName,lastName,primaryPhone,primaryEmail,positionTitle" Importance="High"/>
        </LineItem>
    </EntityType>

    <!--Country（国家）-->
    <EntityType Name="Country" OfbizEntity="Geo" EntityCondition="geoId in (FRA,USA,GBR,ARE,DEU,JPN,ITA,CHE,17)" AutoProperties="true" EntitySetName="Countries">
        <Property Name="geoId">
            <Text Path="geoName" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>
    <EntityType Name="ListedCountry" OfbizType="geoTypeId=COUNTRY" OfbizEntity="Geo" EntityCondition="geoId in (USA,UK,ARE,Europe,CHN)" AutoProperties="true" EntitySetName="ListedCountries">
        <Property Name="geoId">
            <Text Path="geoName" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>
    <!--Province（省份）-->
    <EntityType Name="Province" OfbizEntity="GeoAssocAndGeoTo" EntityCondition="geoTypeId=MUNICIPALITY" AutoProperties="true" EntitySetName="Provinces">
        <Property Name="geoId">
            <Text Path="geoName" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>
    <!--City（城市）-->
    <EntityType Name="City" OfbizEntity="GeoAssocAndGeoTo" EntityCondition="geoTypeId=CITY" AutoProperties="true" EntitySetName="Cities">
        <Property Name="geoId">
            <Text Path="geoName" TextArrangement="TextOnly"/>
        </Property>
    </EntityType>


</ofbiz-edm>
