<ofbiz-edm xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:noNamespaceSchemaLocation="https://dev.odatalab.com/dtds/edmconfig.xsd" ImportGlobal="false">
    <!-- 主对象PurchaseRequest（采购请求）-->
    <EntityType Name="PurchaseRequest" OfbizEntity="CustRequest" EntityCondition="custRequestTypeId=RF_PUR_QUOTE"
                AutoProperties="true"
                EntitySetName="PurchaseRequests" AutoSet="true">

        <!--关联到采购报价单-->
        <NavigationProperty Name="PurchaseQuote" Type="PurchaseQuote" Relations="Quote" IsCollection="true"/>
        <!--关联到产品需求单-->
        <NavigationProperty Name="ProductRequirement" Type="ProductRequirement" Relations="RequirementCustRequest/Requirement" IsCollection="true"/>

        <Action Name="CreatePurchaseRequest" IsBound="true" EntitySetPath="purchaseRequest"
                OfbizService="com.dpbird.odata.events.ActionEvents.createEntity">
            <Parameter Name="purchaseRequest" Type="PurchaseRequest" Nullable="false" IsCollection="true"/>
            <Parameter Name="reason" Type="String" Label="${Reason}"/>
        </Action>
    </EntityType>

    <EntityType Name="PurchaseQuote" OfbizEntity="Quote" EntityCondition="quoteTypeId=PURCHASE_QUOTE" EntitySetName="PurchaseQuotes"
                AutoProperties="true"
                AutoSet="true">

        <!--关联到采购请求单-->
        <NavigationProperty Name="PurchaseRequest" Type="PurchaseRequest" Relations="CustRequest" IsCollection="false"/>
        <!--关联到采购订单-->
        <NavigationProperty Name="PurchaseOrder" Type="PurchaseOrder" Relations="OrderHeader" IsCollection="true"/>

        <Action Name="CreatePurchaseQuote" IsBound="true"
                OfbizService="com.dpbird.odata.events.ActionEvents.createEntity">
            <Parameter Name="purchaseRequest" Type="PurchaseRequest" Nullable="false" IsCollection="true"/>
            <Parameter Name="partyId" Type="String" Label="${QuoteParty}">
                <ValueList CollectionPath="QuoteParties" WithFixedValues="false" ParameterDisplayOnly="phoneMobile,primaryPhone,primaryEmail,address1">
                    <ParameterInOut ValueListProperty="partyId" LocalDataProperty="partyId"/>
                </ValueList>
            </Parameter>
        </Action>
    </EntityType>

    <EntityType Name="PurchaseOrder" OfbizEntity="OrderHeader" EntitySetName="PurchaseOrderHeaders"
                EntityCondition="orderTypeId=PURCHASE_ORDER" Properties="orderId,orderName,orderTypeId,orderName,orderDate,statusId,quoteId,agreementId"
                SearchOption="orderId,orderName,StatusItem/description">

        <!--采购报价单-->
        <NavigationProperty Name="PurchaseQuote" Type="PurchaseQuote" Relations="Quote" IsCollection="false"/>

        <Action Name="CreatePurchaseOrder" IsBound="true"
                OfbizService="com.dpbird.odata.events.ActionEvents.createEntity">
            <Parameter Name="purchaseOrder" Type="PurchaseOrder" Nullable="false" IsCollection="true"/>
        </Action>
    </EntityType>

    <EntityType Name="ProductRequirement" OfbizEntity="Requirement" EntityCondition="requirementTypeId=PRODUCT_REQUIREMENT"
                Properties="requirementId,requirementTypeId,facilityId,productId,statusId"
                EntitySetName="ProductRequirements" AutoSet="true">

        <!--关联多个采购请求单-->
        <NavigationProperty Name="PurchaseRequest" Type="PurchaseRequest" Relations="RequirementCustRequest/CustRequest" IsCollection="true"/>

        <Action Name="CreateProductRequirement" IsBound="true" EntitySetPath="productRequirement"
                OfbizService="com.dpbird.odata.events.ActionEvents.createEntity">
            <Parameter Name="productRequirement" Type="ProductRequirement" Nullable="false" IsCollection="true"/>
        </Action>
    </EntityType>

    <EntityType Name="ProductRequirement" OfbizEntity="Requirement" EntityCondition="requirementTypeId=PRODUCT_REQUIREMENT"
                Properties="requirementId,requirementTypeId,facilityId,productId,statusId"
                EntitySetName="ProductRequirements" AutoSet="true">

        <NavigationProperty Name="PurchaseRequest" Type="PurchaseRequest" Relations="RequirementCustRequest/Requirement" IsCollection="true"/>
    </EntityType>
</ofbiz-edm>